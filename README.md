# 👾 搬史机器人 Pro (Banshi Robot Pro)

> 让“搬史”（搬运群聊梗图、聊天记录）进入人工审核的可视化新时代！

这是一个基于 Web UI 的 QQ 消息可视化审核与转发机器人。你可以通过直观的网页控制台，轻松拦截、预览、筛选指定 QQ 群的聊天记录和多媒体文件，并将其一键“打包”或“直发”到其他群聊。

本项目原生支持 **NapCatQQ** (OneBot V11 协议)，采用纯 Python 编写，无需复杂的数据库，开箱即用。

---

## ✨ 核心功能

- 🖥️ **网页端控制台**：浏览器控制台面板。
- 🕵️ **能工智人审核**：左“媒体”，右“聊天记录”。
- 🛡️ **多级防封策略**：发送信息/聊天记录自动插入延迟。
- 📨 **聊天记录预览**：聊天记录暂时无法在面板中查看，只能发送给审核阅览后再决定是否发送。

---

## 🛠️ 准备工作 (环境依赖)

在开始之前，你需要准备好以下两个软件：
（如果使用打包好的则直接跳转到使用方法，无需配置py环境，NapCatQQ依旧需要配置）
1. **Python 环境**：
   - 需要安装 **Python 3.10** 或以上版本。（[前往官网下载](https://www.python.org/downloads/)）
   - *小白注意：安装 Python 时，务必勾选底部的 `Add Python to PATH`！*
2. **QQ 机器人底层框架 (NapCatQQ)**：
   - 本项目不负责直接登录 QQ，而是负责向 NapCat 下达指令。
   - 你需要先部署好 [NapCatQQ](https://github.com/NapNeko/NapCatQQ) 并在后台登录你的机器人 QQ。

---

## 🚀 快速部署教程

### 第一步：配置 NapCatQQ
打开你的 NapCat 网页控制台（WebUI），进入**网络配置**，点击新建并开启 **WebSocket服务器**，并将端口设置为 `3001`，消息格式为`Array`，Host为`127.0.0.1`，名称随意，确保左上角启用打开以及Token为空。
*(如果你不知道怎么设，只要确保 NapCat 监听了 `ws://127.0.0.1:3001` 即可)*

### 第二步：下载本项目
1. 使用源码：将本项目的代码文件夹下载到你的电脑上，并解压。
2. 使用打包好的软件，跳过以下依赖直接看使用方法。
### 第三步：安装依赖库
1. 打开项目所在的文件夹。
2. 在文件夹地址栏输入 `cmd` 并回车，弹出一个黑色的命令行窗口。
3. 复制并运行以下命令来安装必须的依赖库：
   ```bash
   pip install -r requirements.txt
   ```
### 第四步：启动机器人
- 继续在刚才的黑色窗口中输入：
   ```Bash
  python main.py
  ```
### 当你看到类似 NiceGUI ready to go on http://localhost:8080 的提示时，恭喜你，启动成功！

---

### 📖 使用方法与配置说明
- 启动成功后，打开浏览器，访问 http://localhost:8080 即可看到操作面板。
### 1. 基础配置
- WebSocket 地址：默认填 ws://127.0.0.1:3001 （和 NapCat 的设置保持一致）。
- 来源群 (监控)：输入你要“偷图/偷记录”的 QQ 群号，按回车添加。
- 目标群 (发布)：输入你要发送过去的 QQ 群号，按回车添加。
- 审核员设置：输入你自己的常用 QQ 号。聊天记录可以点击【发送给审核员】先在自己手机上看效果。
- 注意：所有配置点击“保存”后会永久记录，下次启动无需重新填写。

### 2. 开始运行
- 点击左上角绿色的 【开始搬史】 按钮。如果右侧的 STATUS 亮起绿灯 🟢，说明已成功连接到 QQ 机器人！此时如果“来源群”有人发图片、视频或合并转发记录，就会自动出现在你的审核面板上。

### 3. 审核与发送
- 勾选你觉得有意思的内容。点击图片右上角的 🔍 放大镜可以全屏预览。
- 媒体库 (图片/视频)：
  - 点击【直发】：一条一条发到目标群。
  - 点击【打包】：把选中的图做成一条“合并转发”发出去。

- 情报局 (聊天记录)：只能点击【转发】，会原汁原味地转到目标群。

---

### ❓ 常见问题 (FAQ)
- Q1：为什么点击“开始找史”后，状态灯是黄色的 🟡 或红色的 🔴？并且日志一直提示“连接断开”？
- A：这意味着机器人连不上 NapCat。请检查：
  - NapCatQQ 是否正常运行？
  - NapCat 中是否正确开启了“正向 WebSocket”？
  - 设置里的 WebSocket 地址（通常是 ws://127.0.0.1:3001）是否和 NapCat 里配置的端口完全一致？
- Q2：为什么点击“打包”后，日志提示“API 返回错误”或“打包失败”？
  - A：这是因为腾讯 QQ 的风控机制拦截了合并转发消息（可能是图片带了敏感特征，或者是短期内发送太快）。项目自带了“自动保留”机制，打包失败的图片不会丢失。你可以稍等片刻重试，或者直接点击【直发】按钮硬发。
- Q3：为什么日志里显示发送成功了，但群里没看到消息？
  - A：大概率是被 QQ 官方静默屏蔽（吞消息）了。你可以尝试把发送频率调慢，或者不要一次性打包太多违规图片。
- Q4：点击“发送给审核员”，我的 QQ 没收到消息？
  - A：请检查左侧“审核员设置”里的 QQ 号是否填写正确，并且必须确保机器人 QQ 和审核员 QQ 是双向好友。

---

### 🤖 AI介入声明：本项目有AI介入辅助开发

---

### 🙏 鸣谢
本项目在核心理念与业务逻辑上，部分参考并深受以下优秀开源项目的启发：

[astrbot_sowing_discord](https://github.com/anka-afk/astrbot_sowing_discord/tree/main?tab=MIT-1-ov-file) (by anka-afk)
感谢原作者提出的“全自动搬史”概念以及在 OneBot 合并转发逻辑上的探索。

相比于原项目的 Astrbot 插件形态与自动表情审核机制，本项目采用了 NiceGUI 构建独立 Web 控制台，旨在提供更精准的“人工审核”分流与多级防风控兜底发送能力。

本项目完全免费开源，仅供学习交流使用，请勿用于发送违规违法信息。
